<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CANIG — Screen Sound Recorder</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23063f5b%22/><text x=%2250%25%22 y=%2255%25%22 font-size=%2248%22 text-anchor=%22middle%22 fill=%22%23fff%22 font-family=%22Arial%22>CN</text></svg>">

<style>
  :root{
    --bg:#071a25;
    --card:#071f2b;
    --accent:#00d4b4;
    --accent-2:#6c7cff;
    --muted:#9fb2c6;
    --glass: rgba(255,255,255,0.03);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#03121a 0%, #072434 100%);color:#eaf6f3}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;}
  .card{
    width:820px;max-width:96%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.007));
    border-radius:14px;padding:26px;box-shadow:0 10px 40px rgba(2,8,20,0.7);backdrop-filter: blur(6px);
    border:1px solid rgba(255,255,255,0.03);
  }
  .brand{
    display:flex;align-items:center;gap:14px;margin-bottom:6px;
  }
  .logo{
    width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent) 0%, var(--accent-2) 100%);
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#042029;font-size:20px;box-shadow:0 6px 18px rgba(12,20,30,0.5);
  }
  h1{margin:0;font-size:20px}
  .tag{margin-top:4px;color:var(--muted);font-size:13px}
  p.lead{margin:12px 0 18px;color:var(--muted);font-size:14px;line-height:1.4}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;}
  button{
    background:transparent;color:var(--accent);border:1.4px solid rgba(0,212,180,0.12);
    padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;
    transition:transform .12s ease,opacity .12s ease;
  }
  button:hover{transform:translateY(-2px)}
  button.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#00121a;border:0}
  button.warn{background:transparent;color:#ffb86b;border:1.4px solid rgba(255,184,107,0.12)}
  button:disabled{opacity:0.45;cursor:not-allowed}
  .status{margin-top:10px;color:#c7f3e9;font-weight:600}
  .meta{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap}
  .chip{background:var(--glass);padding:8px 10px;border-radius:8px;font-size:13px;color:var(--muted);border:1px solid rgba(255,255,255,0.02)}
  audio{width:100%;margin-top:14px;border-radius:8px;background:transparent}
  .note{margin-top:12px;font-size:13px;color:var(--muted)}
  .footer{margin-top:18px;font-size:13px;color:var(--muted);display:flex;gap:12px;align-items:center;justify-content:space-between}
  .danger{color:#ffb4b4}
  .timer{font-weight:800;color:#bde7ff}
  .brand-right{margin-left:auto;color:var(--muted);font-size:13px}
  /* small responsive */
  @media (max-width:520px){ .controls{flex-direction:column} .brand{gap:10px} .logo{width:48px;height:48px;font-size:18px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-label="CANIG screen audio recorder">
      <div class="brand">
        <div class="logo" aria-hidden="true">CANIG</div>
        <div>
          <h1>CANIG</h1>
          <div class="tag">Capture &amp; Save — Only screen/system audio</div>
        </div>
        <div class="brand-right">v1.0</div>
      </div>

      <p class="lead">
        CANIG se screen/tab/window ka <strong>audio</strong> record karein. <strong>Start Recording</strong> pe click karne par browser aap se poochega ki kaunsa tab/window/screen share karna hai — jis source se sound aa raha ho, use choose karke (Chrome/Edge me "Share audio" check karein).
      </p>

      <div class="controls">
        <button id="startBtn" class="primary" title="Start CANIG recording">Start Recording</button>
        <button id="stopBtn" disabled title="Stop recording">Stop</button>
        <button id="playBtn" disabled title="Preview recording">Play</button>
        <button id="downloadBtn" disabled title="Download recorded file">Download</button>
        <button id="muteBtn" disabled title="Mute/unmute preview">Mute Preview</button>
      </div>

      <div class="meta">
        <div class="chip" id="statusChip">Idle</div>
        <div class="chip">Format: <span id="formatText">webm/opus</span></div>
        <div class="chip">Size: <span id="sizeText">0 KB</span></div>
        <div class="chip">Duration: <span id="duration">00:00</span></div>
      </div>

      <audio id="playback" controls></audio>

      <p class="note">
        CANIG note: Audio aapke machine par hi rehta hai — koi upload nahi hota. Best results ke liye Chrome/Edge desktop use karein. Agar audio nahi aa raha to tab select karke "Share audio" check karein.
      </p>

      <div class="footer">
        <div class="danger">Local only — no uploads</div>
        <div class="timer" id="recTimer">00:00</div>
      </div>
    </div>
  </div>

<script>
  // Elements
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const playBtn = document.getElementById('playBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const muteBtn = document.getElementById('muteBtn');
  const playback = document.getElementById('playback');
  const statusChip = document.getElementById('statusChip');
  const sizeText = document.getElementById('sizeText');
  const durationText = document.getElementById('duration');
  const recTimer = document.getElementById('recTimer');
  const formatText = document.getElementById('formatText');

  let mediaRecorder = null;
  let recordedChunks = [];
  let capturedStream = null;
  let recordingStart = null;
  let timerInterval = null;
  let audioURL = null;

  function setStatus(txt, color) {
    statusChip.textContent = txt;
    if(color) statusChip.style.color = color;
    else statusChip.style.color = '';
  }

  function formatTime(s){
    const mm = String(Math.floor(s/60)).padStart(2,'0');
    const ss = String(Math.floor(s%60)).padStart(2,'0');
    return mm+':'+ss;
  }

  function updateTimer(){
    if(!recordingStart) return;
    const elapsed = (Date.now() - recordingStart)/1000;
    recTimer.textContent = formatTime(elapsed);
    durationText.textContent = formatTime(elapsed);
  }

  startBtn.addEventListener('click', async () => {
    if(!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia){
      alert('Browser does not support screen capture (getDisplayMedia). Use Chrome or Edge on desktop.');
      return;
    }

    startBtn.disabled = true;
    setStatus('Requesting screen share...', '#ffd36b');

    try {
      const constraints = { video: true, audio: true };
      capturedStream = await navigator.mediaDevices.getDisplayMedia(constraints);

      // Check audio tracks
      const audioTracks = capturedStream.getAudioTracks();
      if(!audioTracks || audioTracks.length === 0){
        setStatus('No audio track found in chosen source.', '#ff7b7b');
        startBtn.disabled = false;
        // stop captured stream if exists
        if(capturedStream) capturedStream.getTracks().forEach(t => t.stop());
        capturedStream = null;
        return;
      }

      const audioOnlyStream = new MediaStream();
      audioTracks.forEach(t => audioOnlyStream.addTrack(t));

      // Pick supported mime
      let mime = '';
      if(MediaRecorder.isTypeSupported('audio/webm;codecs=opus')) mime = 'audio/webm;codecs=opus';
      else if(MediaRecorder.isTypeSupported('audio/webm')) mime = 'audio/webm';
      else if(MediaRecorder.isTypeSupported('audio/ogg')) mime = 'audio/ogg';
      else mime = '';

      formatText.textContent = mime || 'default';

      recordedChunks = [];
      mediaRecorder = new MediaRecorder(audioOnlyStream, mime ? { mimeType: mime } : undefined);

      mediaRecorder.ondataavailable = (e) => {
        if(e.data && e.data.size > 0) recordedChunks.push(e.data);
        sizeText.textContent = (recordedChunks.reduce((s, b) => s + b.size, 0) / 1024).toFixed(1) + ' KB';
      };

      mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: recordedChunks[0]?.type || 'audio/webm' });
        if(audioURL) URL.revokeObjectURL(audioURL);
        audioURL = URL.createObjectURL(blob);
        playback.src = audioURL;
        playBtn.disabled = false;
        downloadBtn.disabled = false;
        muteBtn.disabled = false;
        setStatus('Recording stopped — ready to play / download', '#8ef0b1');

        if(capturedStream){
          capturedStream.getTracks().forEach(t => t.stop());
          capturedStream = null;
        }
        clearInterval(timerInterval);
      };

      mediaRecorder.start(250);
      setStatus('Recording...', '#8ef0b1');
      stopBtn.disabled = false;
      startBtn.disabled = true;
      playBtn.disabled = true;
      downloadBtn.disabled = true;
      muteBtn.disabled = true;

      recordingStart = Date.now();
      recTimer.textContent = '00:00';
      timerInterval = setInterval(updateTimer, 500);

    } catch (err) {
      console.error('Capture failed:', err);
      setStatus('Screen share / audio capture cancelled or failed.', '#ff9b9b');
      startBtn.disabled = false;
      if(capturedStream){
        capturedStream.getTracks().forEach(t => t.stop());
        capturedStream = null;
      }
    }
  });

  stopBtn.addEventListener('click', () => {
    if(!mediaRecorder) return;
    setStatus('Stopping...', '#ffd36b');
    stopBtn.disabled = true;
    startBtn.disabled = false;
    try{
      mediaRecorder.stop();
    }catch(e){
      console.warn(e);
      setStatus('Error while stopping recorder.', '#ff7b7b');
    }
  });

  playBtn.addEventListener('click', () => {
    if(!playback.src) return;
    playback.play();
  });

  downloadBtn.addEventListener('click', () => {
    if(!recordedChunks || recordedChunks.length === 0) return;
    const blob = new Blob(recordedChunks, { type: recordedChunks[0].type || 'audio/webm' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);

    const now = new Date();
    const ts = now.toISOString().replace(/[:.]/g,'-');
    a.download = `CANIG-screen-audio-${ts}.webm`;
    document.body.appendChild(a);
    a.click();
    a.remove();
  });

  muteBtn.addEventListener('click', () => {
    playback.muted = !playback.muted;
    muteBtn.textContent = playback.muted ? 'Unmute Preview' : 'Mute Preview';
  });

  window.addEventListener('beforeunload', () => {
    if(capturedStream) capturedStream.getTracks().forEach(t => t.stop());
  });
</script>
</body>
</html>
